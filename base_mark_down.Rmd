---
title: "Daily Step Counts"
author: "Karen, Anastasiia, Linda, Asuman, Narod"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(LearnBayes)
source('TeachBayes.r')
library(tidyverse)
library(rjags)
```

## Prior

We're interested in estimating the average steps of a graduate student per day and how it differs in weekdays and weekend.

Prior parameters $\mu_0,\sigma_0$ are selected based on previous [research studies](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7093766/) which have been tracked via investigators from the National Cancer Institute (NCI) and the National Institute on Aging (NIA).

```{r}
# define our prior data set that is collected from previous publications
# average daily step counts from cohort 3 graduate students
daily_steps <- c(400, 1000, 1500, 6000, 7016, 7820, 8000, 8000, 8000, 8068, 10000, 10000, 10000, 10414, 10953, 11124, 12417, 14000, 14000, 14000, 15000, 3800, 4000, 3000, 4000, 8000, 11822,8000, 7500, 9999, 10000, 12499)

# plot a histogram
hist(daily_steps, 
     main="Histogram for Average Daily Steps", 
     xlab="Steps", 
     border="darkblue", 
     col="lightblue",
     xlim=c(min(daily_steps), 15500),
     las=1, 
     breaks=10)

```

Assume the daily step counts follow a Poisson Distribution, as We have a count data and a time frame which is day in our case. We specify the conjugate $Gamma(\alpha,\beta)$

```{r}
m <- 7500
std <- 2800
  
my_alpha <- m^2/std^2
my_beta <- m/std^2

x <- seq(min(daily_steps), max(daily_steps), length=25)
priorx <- dgamma(x, shape=my_alpha, rate=my_beta)
plot(x, priorx, type='l',lwd=3, xlim = c(min(x), max(x)), ylim=c(0,0.00015),col = 'blue', 
     main = '', xlab = 'Daily Step Counts', ylab = '')
```

## Data collection 

We observed daily step counts of a small group of graduate students, $n=4$ 

```{r}
# daily steps counts of 5G
n1 <- c(11233,16683,19389,1009,8971,9582,5195,9932,16643,7610,7611,15745,7427,7365,6209,15984,17006,11668,11770,9566,14153,8250,14386,18546,19037,11512,9269,5964,8571,8123,10445)
n2 <- c(8632,94,12626,6618,10140,3807,1518,8976,5401,6015,15265,9494,4276,3458,12667,1574,19215,3562,7118,18315,4098,7880,6832,21,10840,12038,13276,13604,9252,13,13473)
n3 <- c(14088,13741,18879,9008,7240,6705,14145,9688,11677,14158,18181,11360,5366,7247,6478,5454,7108,13981,12393,14611,14162,17909,850,658,9519,10773,12942,12354,8212,2122,11823)
n4 <- c(12516,16648,18535,8471,5276,7391,18322,9840,5612,9394,10399,6548,7753,7202,12155,20152,5172,13354,7634,8156,10069,7714,8273,13391,12087,13872,10794,5932,10264,14142,22486)

steps <- c(n1, n2, n3, n4)
students <- c(rep(1,length(n1)),
              rep(2, length(n2)),
              rep(3, length(n3)),
              rep(4, length(n4)))
steps_df <- data.frame(students, steps)
head(steps_df,4)

#plot the daily count steps
ggplot(steps_df, aes(y=steps, group = students)) + 
  geom_boxplot(aes(fill=as.factor(students))) +
  labs(y = "Daily Step Counts" , fill = "Students") + 
  theme_bw()
```

## Hierarchical model in rjags

```{r}
steps_model <- "model{
      # Likelihood model for X[i]
      for(i in 1:length(X)) {
          X[i] ~ dpois(theta[student[i]])
      }

      # Prior models for theta_s
      for(student in 1:n.student) {
      theta[student] ~ dgamma(my_alpha, my_beta)
      }

      # Hyperpriors for a,b
      my_alpha ~ dgamma(2, 0.2)
      my_beta ~ dgamma(1, 0.5)
  }"
```

## Compile the model

```{r}
steps_jags <- jags.model(textConnection(steps_model), 
                        data = list(X = steps_df$steps, student = steps_df$students, 
                                    n.student = 4),
                        n.chains = 4) 
```

## Simulate the posterior from the model 

```{r}
# BURN IN the model
steps_sim <- update(steps_jags, n.iter=10000)
# SIMULATE the posterior    
steps_sim <- coda.samples(model = steps_jags, 
                         variable.names = c("theta","my_alpha","my_beta"), 
                         n.iter=20000)
```


## Plot

```{r}
# plot the simulations
plot(steps_sim)
```

